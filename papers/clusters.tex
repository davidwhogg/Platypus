% This file is part of the Platypus project.
% Copyright 2016 the authors.

% to-do
% - write data and cannon section
% - write method and results section
% - write discussion section
% - put in references
% - cite codes!
% - put in acknowledgement
% - fix all remaining occurrences of ARC, MKN, HWR, or DWH
% - forward to Freeman, others?
% - submit to journal and arXiv

\documentclass[12pt, letterpaper, preprint]{aastex}

% text shit
\newcommand{\acronym}[1]{{\small{#1}}}
\newcommand{\project}[1]{\textsl{#1}}
\newcommand{\apogee}{\project{\acronym{APOGEE}}}
\newcommand{\aspcap}{\project{\acronym{ASPCAP}}}
\newcommand{\gaiaeso}{\project{Gaia--\acronym{ESO}}}
\newcommand{\galah}{\project{\acronym{GALAH}}}
\newcommand{\thecannon}{\project{The~Cannon}}
\newcommand{\foreign}[1]{\textsl{#1}}
\newcommand{\eg}{\foreign{e.\,g.}}
\newcommand{\etal}{\foreign{et\,al.}}
\newcommand{\documentname}{\textsl{Article}}

% math shit
\newcommand{\teff}{T_{\mathrm{eff}}}
\newcommand{\logg}{\log g}

% figure shit
\newcommand{\insanefigure}[1]{%
\includegraphics[width=0.33\textwidth]{./figs/#1_MgFe.png}%
\includegraphics[width=0.33\textwidth]{./figs/#1_MgK.png}%
\includegraphics[width=0.33\textwidth]{./figs/#1_AlMg.png}\\
\includegraphics[width=0.33\textwidth]{./figs/#1_NaO.png}%
\includegraphics[width=0.33\textwidth]{./figs/#1_CN.png}%
\includegraphics[width=0.33\textwidth]{./figs/#1_SAl.png}\\
\includegraphics[width=0.33\textwidth]{./figs/#1_sky.png}%
\includegraphics[width=0.33\textwidth]{./figs/#1_decv.png}%
\includegraphics[width=0.33\textwidth]{./figs/#1_HR.png}}

\begin{document}\sloppy\sloppypar

\title{Chemical tagging: \\
       Identification of stellar phase-space structures \\
       purely by chemical-abundance similarity}
\author{David~W.~Hogg\altaffilmark{1,2,3,4},
        Andrew~R.~Casey\altaffilmark{5},
        M.~Ness\altaffilmark{4},
        Hans-Walter~Rix\altaffilmark{4},
    and~Daniel~Foreman-Mackey\altaffilmark{6}}
\altaffiltext{1}{SCDA}
\altaffiltext{2}{Center for Cosmology and Particle Physics, Department of Phyics,
  New York University, 4 Washington Pl., room 424, New York, NY, 10003, USA}
\altaffiltext{3}{Center for Data Science, New York University, 726 Broadway, 7th Floor, New York, NY 10003, USA}
\altaffiltext{4}{Max-Planck-Institut f\"ur Astronomie, K\"onigstuhl 17, D-69117 Heidelberg, Germany}
\altaffiltext{5}{IoA}
\altaffiltext{6}{UW}
\email{david.hogg@nyu.edu}

\begin{abstract}
% Context:
The chemical-tagging hypothesis is that every star ought to carry---%
in its detailed chemical abundances---%
an informative signature of its molecular-cloud birth location and time.
This idea has not previously yielded scientific successes, probably because of the
noise in chemical-abundance measurements.
However, we have succeeded in improving vastly spectroscopic measurements with \thecannon\ 
(now delivering individual abundances with precisions around 0.04-dex).
% Aims:
We test the chemical-tagging hypothesis by looking at clusters in abundance space
and confirming that they are clustered in phase space.
% Methods:
We identify (by the k-means algorithm) overdensities of stars observed by the \apogee\ spectroscopic survey
in a 15-dimensional chemical-abundance space delivered by \thecannon,
and plot the associated stars in phase space.
We use \emph{only} abundance-space information (no positional information) to identify stellar groups.
% Results:
We find that clusters in abundance space are indeed clusters in phase space.
We recover some known clusters and find other interesting structures.
This confirms the chemical-tagging hypothesis and verifies the precision of abundances delivered by \thecannon.
This is the first-ever project to identify phase-space structures by blind search purely in abundance space;
the prospects for future data sets are very good.
\end{abstract}

\keywords{
  Galaxy: abundances
  ---
  Galaxy: stellar content
  ---
  Galaxy: structure
  ---
  globular clusters: general
  ---
  open clusters and associations: general
  ---
  stars: abundances
}

\clearpage
\section{Introduction}\label{sec:intro}

If every star in the Milky Way was born in a molecular cloud that has
unique chemical-abundance characteristics (as a function of time), and
if every star preserves its surface abundances (or significant aspects
of them) over its lifetime, then stars with common birthplaces and
time ought to be identifiable in their surface abundances.
That is, it ought to be possible to use stellar abundances to link up
co-eval stars---even if at the present day they are no longer close to
one another in phase space---and infer a detailed star-formation and
dynamical history for the Galaxy.
This idea has been dubbed ``chemical tagging''.
It was proposed long ago \citep{Freeman2002} and is one of the
principal motivations for a number of surveys, most notably
\apogee\ \citep{apogee}, \gaiaeso\ \citep{gaiaeso} and \galah\ \citep{galah13, galah15}.
In order to measure chemical tags and infer the Galaxy's dynamical
properties and formation history, these surveys are each measuring high resolution,
high signal-to-noise spectra for hundreds of thousands of stars across
the Galaxy's disk, bulge and halo.

Chemical tagging holds the promise of revealing not just the
star-formation history of the Galaxy, but also the accretion history
(as things that fall in are expected to be chemically distinct from
those that form in the parent body; \citealt{something}) and
stellar-orbit diffusion process like radial mixing and radial
migration (for example, \citealt{Roskar2009, Quillen2015}).  After
stars are born---or after a star cluster is accreted and
disrupted---associations or groups will disperse, through either
coherent orbital evolution or else incoherent diffusion, but the
chemical-abundance tags can in principle make the former members
identifiable as co-eval stellar siblings.

Although undeniably promising---and although it has motivated the
launch of expensive, large-scale spectroscopic surveys---the
chemical-tagging idea has yet to yield scientific fruit.
Part of the reason is that the level of chemical specificity required
is very high:
If there are thousands of (relevant) molecular clouds forming stars in
the recent history of the Milky Way, it will take many abundances,
each measured accurately, to make a sufficiently unique fingerprint
that stellar sibling identification will be reliable.

Stellar spectroscopic surveys now have the resolution, signal-to-noise,
wavelength coverage, and sample sizes to deliver chemical tags.
There are, however, two big issues.
The first is that the physical assumptions behind the idea may require
refinement:
There may be chemical-abundance overlaps among open clusters
\citep{blancocuaresma}; coeval groups of stars may have similar tags
but different birth places \citep{mitschang}, and the
chemical-abundance space might be low in dimensionality \citep{what}.
On the other hand, precise studies of stellar twins \citep{melendez, jofre}
and open clusters \citep{bovy} indicates that chemical abundances ought to be
very precisely similar for co-eval stars.

The second issue for chemical tagging---and the one we address
here---is measurement precision (and accuracy).
The current precision on abundance measurements is not high enough
(for example, \citealt{Ting2015, Martel2015}).
That said, it is clear that the \emph{data} are precise enough;
there is enough signal-to-noise at the relevant locations in spectrum
space to deliver high-precision tags.
Our view is that the traditional methods for making abundance
measurements just aren't mature enough:
There are issues with the physical models, and the data-analysis
methods do not make use of all of the information in the data sets.
Improving the models and exploiting the entire information
content in the data is critical if we are going to deliver useful
chemical tags.

Our contribution in this space has been to develop
\thecannon\ \citep{cannon, ages}, which is a data-driven model for
stellar spectra.
This model can deliver stellar parameters and chemical abundances to
stars, making use of every pixel of every stellar spectrum (that is,
all the information in the data) but making no use at all of physical
models of stars.
It relies only on there being training data---\emph{some} stars for
which parameters and abundances are known and believed.
In companion papers \citep{casey16, ness16} we show that
\thecannon\ can deliver 15 to 19 abundances for stars in the
\apogee\ survey, at precisions higher than even the training data on
which the model is trained.
We say more about this below.
We will show here that \thecannon\ improves chemical abundance measurements
to the point that \emph{chemical tagging is now possible.}
We have thereby effectively saved the collective asses of all the
collaborators in all of the above-referenced large spectroscopic
surveys.

One note on \emph{accuracy} and \emph{precision:}
In principle, the problem of chemical tagging does not require
absolute accuracy for chemical-abundance measurements.
We only require that we can precisely see that two stars are similar
in their abundances; even if we are wrong about the absolute values of
those abundances.
This point might make it seem like we don't care that our models are
wrong, so long as they are \emph{consistent.}
However, this is a bit misleading:
For chemical tagging to succeed, we need stars with different
atmospheric parameters $(\teff, \logg)$ but the same chemical
abundances to be assigned the same position in chemical-abundance
space.
That doesn't require overall accuracy, but it requires that the models
have the right dependencies on atmospheric parameters such that the
wrongness in abundance space is consistent across the H-R diagram.
That is, we need a substantial amount of accuracy to achieve our goals.

In what follows, we are going to use \apogee\ \acronym{DR12} data, in
which we can measure 15 element abundances (C, N, O, Na, Mg, Al, Si,
S, K, Ca, Ti, V, Mn, Fe, Ni).
The \apogee\ data set covers a huge radial extent and---because the
data are taken in the infrared---explores the thin disk.
However, it has the disadvantage that it's spatial coverage is swiss
cheese, which makes it hard to see, within the data set, linear or
extended stellar structures.
In many ways, \galah\ will deliver improvements, both because it will
have more abundances (possibly 29) and contiguous sky coverage.

One final note:
We think of this \documentname\ as performing a hypothesis test.
We know that the stellar members of open and globular clusters---stars
that are identified by being close in phase space---contain highly
informative abundance information that identifies them also in
chemical-abundance space.
Does this work the other way around?
Are groups of stars that are identified as being close in abundance
space---collections of stars with near-identical chemical tags---also
found to be close in phase space?
If the answer to this question is ``yes'' then chemical tagging is
\emph{on.}

\clearpage
\section{Sample and abundances}

The details about how we select, reduce, and analyze the \apogee\ data
are given in full detail in the companion papers \citep{casey16, ness16}.
We summarize briefly here.
For the spectroscopic data, we use the \apogee\ \acronym{DR12}
(\cite{dr12}) spectroscopic data reductions for red-giant stars
($\logg < 3.9$) that are not flagged as bad in the
\apogee\ \aspcap\ (\cite{aspcap}) pipeline reductions.
There are XXXXX stars that make our $\logg$ and flag cuts.

The \apogee\ pipelines deliver stacked (co-added),
pseudo-continuum-normalized spectra, but we do not use these; we
perform our own continuum normalization on individual-exposure data
and co-add it ourselves.
This is required, because the performance of \thecannon\ depends
critically on the methods used for spectral normalization.  It does
not require accurate continuum estimation, but it requires that the
normalization vector be obtained by a \emph{linear operation on the
  data}.
The linear operation we use is a smooth-function fit to pixels
identified as continuum in our previous work \citep{thecannon}.

For the training data labels (used to train \thecannon; see below), we
use the \apogee\ \acronym{DR12} \aspcap\ atmospheric parameters and
15-element abundances, but only for the subset of XXXXX red-giant
stars that have spectral signal-to-noise ratio measurements greater
than 200.
This is a small fraction of the total sample, but these high
signal-to-noise stars are observed to obtain consistent, low-scatter,
sensible abundance-space measurements.

DWH!!  How does \thecannon\ work here?

Six two-dimensional projections of the abundance data, plus some other
data quantities, are shown in \figurename~\ref{fig:all}.

\begin{figure}[!p]
\insanefigure{all}
\caption{Whatevsinator.\label{fig:all}}
\end{figure}

\clearpage
\section{Method and results}

Although only hints of small-scale clustering in the abundance space
are visible in \figurename~\ref{fig:all}, exploration of the data indicates that
known clusters do appear in the abundance space as over-densities.
This encourages us to look for over-densities automatically in the
abundance space and see if anything found that way would be over-dense
in phase space.
The simplest method for clustering points in $D$-dimensional space is
the \emph{k-means} algorithm (DWH CITE).
Briefly, the k-means algorithm is to find the points closest (in
$D$-space) to each of $K$ centers, and then take the mean of those
points to update the locations of the centers; iterate to convergence.
The output is the locations of the $K$ centers and the assignments of
all points to centers.
This algorithm is fast and performs well in practice in problems of
this nature.

The k-means algorithm has disadvantages, of course.
One is that $K$ must be chosen by hand (or heuristically at best).
Here we are only demonstrating a concept; we don't need to have the
best possible clustering.
For this reason we simply choose $K=128, 256, 512$ and look at all the
results.
The algorithm also only performs local optimization.
At each $K$ we perform 32 restarts with different initializations, and
preserve the best clustering (best according to the k-means score).

Another issue with k-means is that it effectively uses metric
distances in the $D$-space; it presumes Euclidean isotropy.
We choose here to work in the hydrogen-normalized abundance space, the
space of [C/H], [N/H], [O/H], [Na/H], [Mg/H], [Al/H], [Si/H], [S/H],
[K/H], [Ca/H], [Ti/H], [V/H], [Mn/H], [Fe/H], [Ni/H].
But in addition to this, we re-scale these by approximate measurement
precisions obtained by \thecannon\ before running k-means.
This makes the space close to isotropic in measurement uncertainty or
observational precision.
Importantly we use \emph{only} abundance-space information, and no
positional or velocity information (nor $\teff$ nor $\logg$ nor any
targeting or observational meta-data) as input to the clustering
algorithm.

DWH: Reminder that we don't need the absolute best clustering to
demonstrate the hypothesis.

When the k-means results are returned, the $D\times D$ empirical
variance tensor for the members of each cluster can be constructed,
and an effective density can be computed as the number of points in
the cluster divided by the square-root of the determinant of the
tensor.
This density was used to rank abundance-space overdensities (from highest
to lowest) for visual inspection.
We chose a few interesting cases from many and show them in
\figurename~\ref{fig:M13}, \ref{fig:Pal5}, \ref{fig:Sgr},
\ref{fig:halo}, and \ref{fig:disk}.
The first three of these are known clusters M13, Pal5, and Sagittarius (MKN, ARC, help!).
The fourth is a halo structure with high velocity dispersion and possibly accreted.
The fifth is a thin-disk star-formation feature.
We will discuss these more below.

All of the code for the clustering and visualization is built on numpy
(DWH CITE), scikit-learn (DWH CITE), and matplotlib (DWH CITE).

\begin{figure}[!p]
\insanefigure{cluster_0256_0253}
\caption{Whatevsinator.\label{fig:infallcluster}}
\end{figure}

\begin{figure}[!p]
\insanefigure{cluster_0256_0034}
\caption{Whatevsinator.\label{fig:Pal5}}
\end{figure}

\begin{figure}[!p]
\insanefigure{cluster_0256_0177}
\caption{Whatevsinator.\label{fig:Sgr}}
\end{figure}

\begin{figure}[!p]
\insanefigure{cluster_0256_0010}
\caption{Whatevsinator.\label{fig:halo}}
\end{figure}

\begin{figure}[!p]
\insanefigure{cluster_0256_0141}
\caption{Whatevsinator.\label{fig:disk}}
\end{figure}

\clearpage
\section{Discussion}

DWH: What have we demonstrated?

DWH: For the first time/H], [we see small-scale informative features in abundance space.

DWH: When we identify the small-scale features in abundance space,they are informative in position space.

DWH: How do we show that we aren't just getting clusters because \apogee\ has plate-to-plate calibration variations?

DWH: Chemical tagging will work.

\acknowledgements
DWH: It is a pleasure to thank...

DWH: grants and grant numbers.

DWH: SDSS-III and SDSS-IV.

DWH: NASA ADS

DWH: github repo and hash.

DWH: Be sure to cite software a la the new ApJ guidelines.

\clearpage
\begin{thebibliography}{24}\raggedright
\bibitem[Ness \etal(2016)]{ness16}
whatev
\end{thebibliography}

\end{document}
